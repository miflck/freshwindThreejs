<!DOCTYPE html>
<html lang="en">
	<head>
		<title>FreshWind</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">

		<!-- Import threejs and additional sources -->
		<script src="src/threejs/three.js"></script>
		<script src='src/threejs/lines/LineSegmentsGeometry.js'></script>
		<script src='src/threejs/lines/LineMaterial.js'></script>
		<script src='src/threejs/lines/LineSegments2.js'></script>

		<!-- Import wind sources -->
		<!--	<script src="src/helper.js?v=0.3"></script>
	<script src="src/WindVane.js?v=0.3"></script>
		<script src="src/Wind.js?v=0.4"></script>-->
		<script src="src/app.js?v=1.0"></script>


	</head>
	<body>



<canvas id="c"></canvas>

<div class="wrapper">
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>

<div class=tile wind-tile no-image>
	<div class="windcontainer">1</div>
</div>
	<div class="windcontainer">2</div>

	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>

	<div class="windcontainer">3</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="windcontainer">4</div>

	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>
	
	<div class="text">
	Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. 
	</div>

	  <div style="clear: both;"></div> 

</div>
  
	<script>
	 	
		// stop automatic wind
		bIsTimed=true;

		window.onload = init;

		//  Key listener to debug and test. not necessary in productionâ€¦
		document.addEventListener('keydown', function(event) {
			// w to make wind
    		if (event.keyCode == 87) {
				scenes.forEach( function ( scene ) {

					var rect = scene.userData.view.getBoundingClientRect();
					// check if it's offscreen. If so skip it
					if ( rect.bottom < 0 || rect.top > renderer.domElement.clientHeight ||
						 rect.right < 0 || rect.left > renderer.domElement.clientWidth ) {
						return; // it's off screen
					}
					makeRandomWind(scene,0);
				});
   			}
		}, false);



document.addEventListener('mousemove', throttle(function (event) {

  		directionX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
  		directionY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;
		scenes.forEach( function ( scene ) {

						var rect = scene.userData.view.getBoundingClientRect();
						// check if it's offscreen. If so skip it
						if ( rect.bottom < 0 || rect.top > renderer.domElement.clientHeight ||
							 rect.right < 0 || rect.left > renderer.domElement.clientWidth ) {
							return; // it's off screen
						}
					makeRandomWind(scene,0);

			});
		
	},500));
		


	document.addEventListener("scroll", throttle(function (event) {

  		directionX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;
  		directionY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;
		scenes.forEach( function ( scene ) {

						var rect = scene.userData.view.getBoundingClientRect();
						// check if it's offscreen. If so skip it
						if ( rect.bottom < 0 || rect.top > renderer.domElement.clientHeight ||
							 rect.right < 0 || rect.left > renderer.domElement.clientWidth ) {
							return; // it's off screen
						}
					makeRandomWind(scene,0);

			});
		
	},500));
		



function debounce(fn, delay) {
	var timer = null;
	return function () {
		var context = this, args = arguments;
		clearTimeout(timer);
    	timer = setTimeout(function () {
			fn.apply(context, args);
    	}, delay);
  	};
}







function debounce(fn, delay) {
	var timer = null;
	return function () {
		var context = this, args = arguments;
		clearTimeout(timer);
    	timer = setTimeout(function () {
			fn.apply(context, args);
    	}, delay);
  	};
}



// as long as it continues to be invoked, raise on every interval
function throttle (func, interval) {
  var timeout;
  return function() {
    var context = this, args = arguments;
    var later = function () {
      timeout = false;
    };
    if (!timeout) {
      func.apply(context, args)
      timeout = true;
      setTimeout(later, interval)
    }
  }
}




	</script>

	</body>
</html>