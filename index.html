<!DOCTYPE html>
<html lang="en">
	<head>
		<title>FreshWind</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link type="text/css" rel="stylesheet" href="main.css">
		<link type="text/css" rel="stylesheet" href="monitor.css">

		<!-- Import threejs and additional sources -->
				<script src="src/threejs/dat.gui.min.js"></script>

		<script src="src/threejs/three.js"></script>
		<script src="src/threejs/stats.min.js"></script>


		<script src='src/threejs/lines/LineSegmentsGeometry.js'></script>
		<script src='src/threejs/lines/LineMaterial.js'></script>
		<script src='src/threejs/lines/LineSegments2.js'></script>
		<script src='src/threejs/lines/Line2.js'></script>


		<!-- Import p5 for audio -->
		<script language="javascript" type="text/javascript" src="src/p5/p5.min.js"></script>
		<script language="javascript" type="text/javascript" src="src/p5/addons/p5.sound.js"></script>
		<script language="javascript" type="text/javascript" src="src/p5/addons/p5.sound.min.js"></script>

		 <script language="javascript" type="text/javascript" src="src/p5/addons/p5.dom.js"></script> 




		<!--<script type="text/javascript"  src="src/audioInput.js"></script>-->

		<!-- Import wind sources -->
		<script src="src/helper.js?v=0.3"></script>
		<script src="src/WindVane.js?v=0.3"></script>
		<script src="src/Wind.js?v=0.4"></script>
		<script src="src/app.js?v=1.0"></script>


	</head>
	<body>


		<!--Example SCRIPT FOR BUTTONS -->
		<!-- To create whitespace for content, set state to CONTENT:
			setState(CONTENT)
			To hide the space again, set state to WIND
		  -->
		

	

      <!-- container for the threejs action -->
 	<div id="playground-content"></div>

	
	 
	<script>

 		let oldX = 0, oldY = 0;


	 	/* the application wants some background images*/ 
	    var files = ['images/1x/01.png','images/1x/02.png','images/1x/03.png','images/1x/04.png','images/1x/05.png','images/1x/06.png','images/1x/07.png','images/1x/08.png','images/1x/09.png','images/1x/10.png','images/1x/11.png','images/1x/12.png',];

	    //var files = ['images/2/1.png','images/2/2.png','images/2/3.png','images/2/4.png','images/2/5.png','images/2/6.png'];
	   	//var files = ['images/2/1.png'];

	    /* load the backgroundimages*/
		loadBackgroundImages(files);


		// set empty space for content
		setContentRect(300,180,900,windowHeight-180);

		bIsTimed=false;

		//setup
		init();
		// start loop
		animate();

		//  Key listener to debug and test. not necessary in productionâ€¦
		document.addEventListener('keydown', function(event) {
			// w to make wind
    		if (event.keyCode == 87) {
				makeRandomWind(1);

   			}
   			// q to change background image
    		else if (event.keyCode == 81) {
    			cycleImages();
     			makeRandomWind(1);
    		}
    		// t to toggle automatic timer
     		else if(event.keyCode==84){
    			bIsTimed=!bIsTimed;
    		}
    		// n to make nullwind
    		if (event.keyCode == 78) {
				makeRandomWind(0);
   			}

			// c to show content
    		if (event.keyCode == 67) {

			cycleImages();

    			// fade In content
    			//var element = document.getElementById("content");
    			//element.classList.remove("fadeOut");
 				//element.classList.add("fadeIn");
 				// set contentstate for app
				//setState(CONTENT);

   			}
   			// x to show wave
    		if (event.keyCode == 88) {
    			//fade out content
    			var element = document.getElementById("content");
    			element.classList.remove("fadeIn");
 				element.classList.add("fadeOut");
 				//set windstate for app
				setState(WIND);
   			}

		}, false);




		document.addEventListener('click', function (event) {
		
		
			if(Math.random()<0.7){
				if(Math.random()<0.7){
				cycleImages();
			}
				//makeRandomWind(1);	
				makeWindFromLocation(event.pageX,event.pageY,1);

			}else{
				makeWindFromLocation(event.pageX,event.pageY,0);
			}
		});


document.addEventListener("touchstart", function(event){

if(Math.random()<0.7){
				if(Math.random()<0.7){
				cycleImages();
			}
				//makeRandomWind(1);	
				makeWindFromLocation(event.pageX,event.pageY,1);

			}else{
				makeWindFromLocation(event.pageX,event.pageY,0);
			}
	
});





window.addEventListener( 'resize', onWindowResize, false );
function onWindowResize() {
	resetScene();

}








	/*	document.addEventListener('mousemove', throttle(function (event) {

		  let directionX = 0, directionY = 0, diffX = 0, diffY = 0;
		      if (event.pageX < oldX) {
		          directionX = "left"
		          diffX = oldX - event.pageX;
		      } else if (event.pageX > oldX) {
		          directionX = "right"
		          diffX = event.pageX - oldX;
		      }

		      if (event.pageY < oldY) {
		          directionY = "top"
		          diffY = oldY - event.pageY;
		      } else if (event.pageY > oldY) {
		          directionY = "bottom";
		          diffY = event.pageY - oldY;
		      }

		      oldX = event.pageX;
		      oldY = event.pageY;

		     // console.log(diffX);

		      if(directionX=="left"){
		      	makeWindFromLocationWithForce(windowWidth+100,event.pageY,1,diffX);

		      }
		      else if (directionX=="right"){
		    	makeWindFromLocationWithForce(-100,event.pageY,1,diffX);
		      }
		//makeWindFromLocation();
	

			
		
	},1500));
*/

function debounce(fn, delay) {
	var timer = null;
	return function () {
		var context = this, args = arguments;
		clearTimeout(timer);
    	timer = setTimeout(function () {
			fn.apply(context, args);
    	}, delay);
  	};
}


// as long as it continues to be invoked, raise on every interval
function throttle (func, interval) {
  var timeout;
  return function() {
    var context = this, args = arguments;
    var later = function () {
      timeout = false;
    };
    if (!timeout) {
      func.apply(context, args)
      timeout = true;
      setTimeout(later, interval)
    }
  }
}


	</script>

	</body>
</html>